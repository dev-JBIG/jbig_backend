# Gemini 주요 리팩토링 요약 (2025-09-06)

이 문서는 Django 백엔드에 적용된 주요 리팩토링 작업, 특히 검색 성능과 사용자 모델 단순화에 초점을 맞춰 요약합니다.

## 1. 검색 성능 전면 개선

### 문제점
이전 검색 구현은 매우 비효율적이었습니다. 모든 검색 요청에 대해 디스크에서 모든 게시물의 HTML 파일을 메모리로 로드하고 하나씩 검색했습니다. 이는 확장성이 없으며 심각한 성능 저하 및 서버 부하를 유발합니다.

### 해결책
Django의 `django.contrib.postgres` 모듈을 사용하여 강력한 데이터베이스 수준의 전체 텍스트 검색(FTS)을 구현했습니다.

- **파일**: `boards/models.py`
  - `Post` 모델에 `SearchVectorField`(`search_vector`)가 추가되었습니다. 이 필드는 빠른 검색을 위해 사전 처리되고 인덱싱된 텍스트 콘텐츠를 저장합니다.
  - `Post` 모델에 `update_search_vector` 메소드를 추가하여 게시물 제목과 HTML 콘텐츠 파일의 가중치 있는 콘텐츠로 이 필드를 채웁니다.

- **파일**: `boards/serializers.py`
  - `PostCreateUpdateSerializer`가 게시물이 생성되거나 업데이트된 후 `update_search_vector`를 호출하도록 수정되어 검색 인덱스가 항상 최신 상태로 유지되도록 합니다.

- **파일**: `boards/views.py`
  - `PostSearchView`가 완전히 리팩토링되었습니다. 더 이상 디스크에서 파일을 읽지 않습니다.
  - 이제 `SearchQuery` 및 `SearchRank`를 사용하여 인덱싱된 `search_vector` 필드에 대해 매우 효율적인 FTS 쿼리를 수행합니다.
  - 이제 검색 결과가 관련성별로 순위가 매겨져 더 나은 사용자 경험을 제공합니다.

- **마이그레이션**:
  - `posts` 테이블에 `search_vector` 필드와 데이터베이스 인덱스를 추가하기 위해 스키마 마이그레이션(`0011_...`)이 생성되었습니다.
  - 모든 기존 게시물에 대해 `search_vector`를 채우기 위해 데이터 마이그레이션(`0012_...`)이 생성되어 업데이트 후 즉시 검색할 수 있도록 합니다.

### 결과
이제 검색 기능은 비효율적인 파일 I/O 대신 PostgreSQL 데이터베이스의 성능을 활용하여 매우 빠르고 확장 가능합니다.

## 2. 사용자 모델 단순화

### 문제점
코드베이스에는 사용자에게 할당되었지만 권한 확인에는 사용되지 않는 `Role` 모델(`admin`, `user`)이 포함되어 있었습니다. 모든 권한 부여 논리는 Django의 내장 `is_staff` 부울 필드에 의존했습니다. 이로 인해 혼란스럽고 중복된 시스템이 생성되었습니다.

### 해결책
사용자 모델을 단순화하고 Django 모범 사례에 맞게 사용되지 않는 `Role` 시스템을 완전히 제거했습니다.

- **파일**: `users/models.py`
  - `Role` 모델이 삭제되었습니다.
  - `User` 모델에서 `role` 외래 키 필드가 제거되었습니다.
  - `UserManager`가 역할 생성 또는 할당과 관련된 모든 논리를 제거하도록 단순화되었습니다. 이제 Django의 `AbstractUser`에서 제공하는 `is_staff` 및 `is_superuser` 필드를 올바르게 사용합니다.

- **마이그레이션**:
  - 데이터베이스에 이러한 변경 사항을 적용하고 `user` 테이블에서 `role` 필드를 제거하고 `role` 테이블을 삭제하기 위해 스키마 마이그레이션(`0011_...`)이 생성되었습니다.

### 결과
이제 사용자 모델은 더 간단하고 직관적이며 Django의 표준적이고 잘 문서화된 권한 부여 필드에 의존합니다. 이를 통해 코드 복잡성이 줄어들고 향후 개발 및 유지 관리가 더 쉬워집니다.
