# Gemini 리팩토링 요약 (2025-09-06)

이 문서는 Django 백엔드, 특히 'boards' 애플리케이션에 대해 수행된 리팩토링 작업을 요약합니다.

## 1. 문제 분석

기존 코드베이스에는 권한 및 코드 구조와 관련된 몇 가지 문제가 있었습니다.
- **복잡하고 중복된 로직**: 권한 및 데이터 필터링 로직이 여러 뷰에 흩어져 있어 코드 중복 및 유지 관리의 어려움을 초래했습니다.
- **모델 필드의 불분명한 역할**: `board_type` 및 `users.Role`과 같은 필드는 권한 시스템에서 명확한 기능이 없어 혼란을 야기했습니다.
- **낮은 가독성**: "매직 넘버"(예: `post_type == 2`) 사용과 디버그 문장이 남아 있어 코드를 읽고 유지 관리하기가 어려웠습니다.
- **중복 권한**: `Board` 모델의 `Meta.permissions`는 커스텀 권한 클래스를 사용하여 중복되었습니다.

## 2. 리팩토링 세부 정보

이러한 문제를 해결하기 위해 다음과 같은 변경 사항이 구현되었습니다.

### 2.1. 로직 중앙화 (DRY 원칙)
- `Post` 모델에 대한 커스텀 모델 관리자(`PostManager`)가 생성되었습니다.
- `Post.objects.visible_for_user(user)`라는 새로운 메소드가 도입되었습니다. 이 단일 메소드에는 이제 사용자의 상태(스태프, 인증, 익명) 및 게시물 유형에 따라 게시물을 필터링하기 위한 모든 로직이 포함됩니다.
- 모든 관련 뷰(`PostListCreateAPIView`, `AllPostListAPIView`, `PostSearchView`)가 이 중앙 집중식 메소드를 사용하도록 리팩토링되어 상당한 코드 중복을 제거했습니다.

### 2.2. 모델 개선
- **`board_type` 및 권한 연결**: `Board` 모델의 `save()` 메소드가 재정의되었습니다. 이제 보드의 `board_type`을 변경하면(예: 'Admin'으로) 적절한 `read_permission`, `post_permission` 및 `comment_permission`이 자동으로 설정되어 보드 관리가 더 직관적이고 오류 발생 가능성이 줄어듭니다.
- **열거형으로 가독성 향상**: `POST_TYPE_CHOICES` 및 `BOARD_TYPE_CHOICES`가 Django의 `IntegerChoices`를 사용하도록 변환되었습니다. 이를 통해 더 읽기 쉬운 코드(예: `2` 대신 `Post.PostType.STAFF_ONLY`)가 가능합니다.

### 2.3. 코드 정리
- `boards/permissions.py`에서 모든 디버깅 `print()` 문이 제거되었습니다.
- `Board` 모델의 `Meta` 클래스에 있는 중복 `permissions` 옵션이 제거되었습니다.
- 해당 데이터베이스 마이그레이션(`0010_alter_board_options.py`)이 생성되었습니다.

### 2.4. API 문서 (Swagger)
- `boards/views.py`의 영향을 받는 모든 API 엔드포인트에 대한 설명이 `@extend_schema`를 사용하여 업데이트되었습니다.
- 이제 문서는 새롭고 단순화된 권한 및 필터링 로직을 정확하게 반영하여 프론트엔드 개발자에게 명확한 지침을 제공합니다.

## 3. 결과

이제 'boards' 애플리케이션은 더 강력하고 유지 관리가 용이하며 이해하기 쉬워졌습니다. 중앙 집중식 권한 로직은 버그 발생 위험을 줄이고 향후 수정을 단순화합니다.
